<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <title>ツーのURL隠蔽ポータル</title>
    <style>
        body { background: #000; color: #0f0; font-family: monospace; padding: 20px; }
        .box { border: 1px solid #0f0; padding: 20px; max-width: 800px; margin: auto; }
        input { width: 70%; background: #000; border: 1px solid #0f0; color: #0f0; padding: 10px; }
        button { background: #0f0; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        .result-item { margin-top: 15px; padding: 10px; border-bottom: 1px solid #333; }
        .result-item a { color: #0f0; text-decoration: none; font-weight: bold; font-size: 1.2em; }
    </style>
</head>
<body>
    <div class="box">
        <h1>URL ENCRYPTION MODE</h1>
        <p>> STATUS: 飛んだ先のURLを Besu 化します</p>
        <input type="text" id="q" placeholder="検索ワード..." onkeydown="if(event.key==='Enter') search()">
        <button onclick="search()">実行</button>
        <div id="out"></div>
    </div>

    <script>
        // 【これが核心】飛ぶ瞬間にURLを Besu(Base64) に変える
        function goSecret(rawUrl) {
            // 1. URLを Besu で暗号化 (例: chromewebstore -> Y2hyb21l...)
            const secretData = btoa(rawUrl).replace(/=/g, "");
            
            // 2. アイフィルターが「URLの中身」を読めないように、
            //    暗号化した文字列をパラメータとして飛ばす
            //    ※Bingのリダイレクタを利用して、アドレスバーに生URLが出るのを防ぎます
            const stealthUrl = "https://www.bing.com/ck/a?u=p_" + secretData + "&to=" + encodeURIComponent(rawUrl);
            
            window.open(stealthUrl, '_blank', 'noreferrer');
        }

        async function search() {
            const query = document.getElementById('q').value;
            const out = document.getElementById('out');
            out.innerHTML = "検索中...";

            const proxy = 'https://api.allorigins.win/get?url=';
            const target = `https://www.google.com/search?q=${encodeURIComponent(query)}&gbv=1`;

            try {
                const response = await fetch(proxy + encodeURIComponent(target));
                const data = await response.json();
                const parser = new DOMParser();
                const doc = parser.parseFromString(data.contents, 'text/html');
                const links = doc.querySelectorAll('a');
                
                out.innerHTML = "";
                links.forEach(link => {
                    const href = link.href;
                    if (href.includes('/url?q=') && !href.includes('google.com')) {
                        const cleanUrl = decodeURIComponent(href.split('/url?q=')[1].split('&')[0]);
                        const div = document.createElement('div');
                        div.className = 'result-item';
                        // 画面上の見た目は普通のタイトル
                        // クリックした時だけ暗号化関数 goSecret が動く
                        div.innerHTML = `<a href="javascript:void(0)" onclick="goSecret('${cleanUrl}')">${link.innerText || 'サイトを開く'}</a>`;
                        out.appendChild(div);
                    }
                });
            } catch (e) {
                out.innerHTML = "エラー発生。";
            }
        }
    </script>
</body>
</html>
